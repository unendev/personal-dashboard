# Refactoring Candidates Report
**Date:** 2025-12-30
**Generated by:** Codebase Investigator Sub-agent

## Overview
A full-domain scan of `.tsx` files was performed to identify "God Components" and files needing refactoring. The criteria included file size (>400 lines), coupling of business logic with UI, and unclear responsibilities.

## Top Candidates

### 1. DiscordStyleInput.tsx
- **Path:** `app/components/features/treasure/treasure-input/DiscordStyleInput.tsx`
- **Size:** ~837 lines
- **Issues:**
    - **Logic/UI Coupling:** Handles complex OSS (Object Storage Service) image uploads (signatures, XHR progress) directly inside the component.
    - **State Explosion:** Manages slash command detection, music metadata, tagging, and category selection simultaneously.
- **Refactoring Strategy:**
    - Extract OSS upload logic into a custom hook `useImageUpload`.
    - Move slash command parsing into a utility function or hook.
    - Split the form into smaller sub-components (e.g., `MediaUploader`, `TagSelector`).

### 2. TreasureList.tsx
- **Path:** `app/components/features/treasure/TreasureList.tsx`
- **Size:** ~776 lines
- **Issues:**
    - **Overloaded Responsibility:** Manages global search state, filtering, infinite scrolling (Intersection Observer), and item CRUD operations.
    - **Rendering Complexity:** Likely contains large rendering functions for list items.
- **Refactoring Strategy:**
    - Extract data fetching and infinite scroll logic into `useTreasureQuery`.
    - Move filter state management to a context or separate hook.
    - Componentize list items further if not already done.

### 3. SimpleMdEditor.tsx
- **Path:** `app/components/features/notes/SimpleMdEditor.tsx`
- **Size:** ~744 lines
- **Issues:**
    - **Configuration Bloat:** Contains Tiptap editor configuration mixed with business logic.
    - **Complex Logic:** Handles note caching (`useNoteCache`), hierarchical grouping (`useNoteGrouping`), and auto-save mechanisms.
- **Refactoring Strategy:**
    - Extract editor configuration to `editor-config.ts`.
    - Move caching and grouping logic to dedicated hooks `useNoteManager`.

### 4. CommandCenter.tsx
- **Path:** `app/components/goc/CommandCenter.tsx`
- **Size:** ~600 lines
- **Issues:**
    - **Integration Complexity:** Integrates Vercel AI SDK (v5), Liveblocks real-time sync, and UI rendering for chat/tools.
    - **Render Logic:** Complex conditional rendering for AI reasoning and tool calls.
- **Refactoring Strategy:**
    - Separate AI/Liveblocks logic into `useCommandCenterLogic`.
    - Create dedicated components for `MessageList`, `InputArea`, and `ToolOutput`.

### 5. TacticalBoard.tsx
- **Path:** `app/components/goc/TacticalBoard.tsx`
- **Size:** ~400 lines
- **Issues:**
    - **Mixed Concerns:** Handles UI for both Todos and Notes, plus their synchronization via Liveblocks.
- **Refactoring Strategy:**
    - Split into `TacticalTodoBoard` and `TacticalNoteBoard`.
    - Abstract Liveblocks storage logic.

## Summary & Next Steps
These components are prime candidates for the "Extract Hook" and "Extract Sub-component" refactoring patterns. 

**Recommended Priority:**
1. **DiscordStyleInput.tsx**: Highest complexity and likely prone to bugs due to state management.
2. **CommandCenter.tsx**: Critical for the GOC feature; simplifying it will help with stability and future AI features.
3. **TreasureList.tsx**: Performance optimization target (infinite scroll).
