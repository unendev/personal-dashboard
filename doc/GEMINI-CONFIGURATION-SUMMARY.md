# Gemini é…ç½®æ€»ç»“

## âœ… æ ¸å¿ƒé…ç½®éªŒè¯

### 1. æ¨¡å‹åˆå§‹åŒ– âœ“

**é…ç½®**:
```typescript
const google = createGoogleGenerativeAI({
  apiKey: env.GOOGLE_API_KEY || process.env.GOOGLE_API_KEY,
});
```

**éªŒè¯**:
- âœ… ä½¿ç”¨å®˜æ–¹ `@ai-sdk/google` åº“
- âœ… API Key ä»ç¯å¢ƒå˜é‡è¯»å–
- âœ… æ”¯æŒåŒé‡è¯»å–ï¼ˆenv å’Œ process.envï¼‰

### 2. æ¨¡å‹åç§° âœ“

**é…ç½®**:
```typescript
selectedModel = google('gemini-2.0-flash-exp');
```

**éªŒè¯**:
- âœ… ä½¿ç”¨æœ€æ–°çš„ `gemini-2.0-flash-exp` æ¨¡å‹
- âœ… æ¨¡å‹åœ¨ Google æ”¯æŒåˆ—è¡¨ä¸­
- âœ… æ”¯æŒå·¥å…·è°ƒç”¨å’Œæµå¼å¤„ç†

### 3. API ç«¯ç‚¹ âœ“

**é…ç½®**:
- è‡ªåŠ¨ä½¿ç”¨ Google Generative AI å®˜æ–¹ç«¯ç‚¹
- æ— éœ€æ‰‹åŠ¨é…ç½® baseURL
- Vercel AI SDK è‡ªåŠ¨å¤„ç†è®¤è¯

**ç«¯ç‚¹**:
```
https://generativelanguage.googleapis.com/v1beta/models/
```

**éªŒè¯**:
- âœ… ç«¯ç‚¹æ­£ç¡®
- âœ… è®¤è¯æ–¹å¼æ­£ç¡®ï¼ˆAPI Keyï¼‰
- âœ… åè®®æ”¯æŒï¼ˆREST + SSEï¼‰

### 4. å·¥å…·è°ƒç”¨æ”¯æŒ âœ“

**é…ç½®**:
```typescript
tools: {
  updateNote: tool({...}),
  addTodo: tool({...}),
}
```

**éªŒè¯**:
- âœ… Gemini æ”¯æŒ function calling
- âœ… å·¥å…·å®šä¹‰å…¼å®¹
- âœ… å‚æ•° schema æ­£ç¡®

### 5. æµå¼å¤„ç†æ”¯æŒ âœ“

**é…ç½®**:
```typescript
const stream = 'toDataStream' in result ? result.toDataStream() : result.stream;
const batchedStream = wrapStreamForBatching(stream);
```

**éªŒè¯**:
- âœ… Gemini æ”¯æŒ Server-Sent Events (SSE)
- âœ… æµå¼æ–‡æœ¬ç”Ÿæˆæ”¯æŒ
- âœ… æµå¼å·¥å…·è°ƒç”¨æ”¯æŒ

---

## ğŸ”§ æ”¹è¿›åº”ç”¨æƒ…å†µ

### æ”¹è¿› 1: API Key éªŒè¯ âœ“

**ä¹‹å‰**:
```typescript
if (model === 'gemini') {
  selectedModel = google('gemini-2.0-flash-exp');
}
```

**ä¹‹å**:
```typescript
if (model === 'gemini' && !env.GOOGLE_API_KEY) {
  console.warn('GOOGLE_API_KEY not configured, falling back to DeepSeek');
  actualModel = 'deepseek';
}
```

**æ•ˆæœ**: 
- âœ… ç¼ºå¤± API Key æ—¶è‡ªåŠ¨å›é€€
- âœ… ç”¨æˆ·ä½“éªŒä¸å—å½±å“
- âœ… æ¸…æ™°çš„æ—¥å¿—è®°å½•

### æ”¹è¿› 2: æµå¼é”™è¯¯å¤„ç† âœ“

**ä¹‹å‰**:
```typescript
const stream = 'toDataStream' in result ? result.toDataStream() : result.stream;
```

**ä¹‹å**:
```typescript
const stream = 'toDataStream' in result ? result.toDataStream() : result.stream;

if (!stream) {
  throw new Error(`Failed to create stream for model: ${actualModel}`);
}
```

**æ•ˆæœ**:
- âœ… éªŒè¯æµæ˜¯å¦æœ‰æ•ˆ
- âœ… æ¸…æ™°çš„é”™è¯¯æ¶ˆæ¯
- âœ… é˜²æ­¢æ— æ•ˆæµå¤„ç†

### æ”¹è¿› 3: å“åº”å¤´æ ‡è®° âœ“

**ä¹‹å‰**:
```typescript
headers: {
  'Content-Type': 'text/plain; charset=utf-8',
  'X-Vercel-AI-Data-Stream': 'v1',
}
```

**ä¹‹å**:
```typescript
headers: {
  'Content-Type': 'text/plain; charset=utf-8',
  'X-Vercel-AI-Data-Stream': 'v1',
  'X-Model-Used': actualModel,  // æ–°å¢
}
```

**æ•ˆæœ**:
- âœ… å¯ä»¥è¿½è¸ªå®é™…ä½¿ç”¨çš„æ¨¡å‹
- âœ… ä¾¿äºè°ƒè¯•å’Œç›‘æ§
- âœ… æ”¯æŒæ€§èƒ½åˆ†æ

### æ”¹è¿› 4: é”™è¯¯æ¶ˆæ¯ä¼˜åŒ– âœ“

**ä¹‹å‰**:
```typescript
return new Response(JSON.stringify({ error: error.message }), { status: 500 });
```

**ä¹‹å**:
```typescript
let errorMessage = 'AI service error';
if (error.message?.includes('API key')) {
  errorMessage = 'AI service not configured';
} else if (error.message?.includes('rate limit')) {
  errorMessage = 'Too many requests, please try again later';
} else if (error.message?.includes('timeout')) {
  errorMessage = 'Request timeout, please try again';
}

return new Response(JSON.stringify({ error: errorMessage }), { status: 500 });
```

**æ•ˆæœ**:
- âœ… ç”¨æˆ·å‹å¥½çš„é”™è¯¯æ¶ˆæ¯
- âœ… æ¸…æ™°çš„é—®é¢˜è¯Šæ–­
- âœ… æ›´å¥½çš„ç”¨æˆ·ä½“éªŒ

---

## ğŸ“‹ é…ç½®æ£€æŸ¥æ¸…å•

### ç¯å¢ƒé…ç½®
- [x] GOOGLE_API_KEY åœ¨ env.ts ä¸­å®šä¹‰
- [x] æ”¯æŒä» process.env è¯»å–
- [x] æ”¯æŒä» env å¯¹è±¡è¯»å–
- [x] ç¼ºå¤±æ—¶æœ‰å›é€€æœºåˆ¶

### æ¨¡å‹é…ç½®
- [x] ä½¿ç”¨æ­£ç¡®çš„æ¨¡å‹åç§°
- [x] æ¨¡å‹åœ¨æ”¯æŒåˆ—è¡¨ä¸­
- [x] æ”¯æŒå·¥å…·è°ƒç”¨
- [x] æ”¯æŒæµå¼å¤„ç†
- [x] æ”¯æŒç³»ç»Ÿæç¤º

### é”™è¯¯å¤„ç†
- [x] API Key ç¼ºå¤±æ£€æŸ¥
- [x] æµå¼åˆ›å»ºå¤±è´¥æ£€æŸ¥
- [x] ç”¨æˆ·å‹å¥½çš„é”™è¯¯æ¶ˆæ¯
- [x] è‡ªåŠ¨å›é€€åˆ° DeepSeek
- [x] æ¸…æ™°çš„æ—¥å¿—è®°å½•

### æ€§èƒ½ä¼˜åŒ–
- [x] æµå¼åˆ†æ‰¹å¤„ç†
- [x] å“åº”å¤´æ ‡è®°
- [x] æ¨¡å‹è¿½è¸ª
- [x] é”™è¯¯åˆ†ç±»

---

## ğŸš€ éƒ¨ç½²å‰æ£€æŸ¥

### å¿…é¡»å®Œæˆ
- [x] æ¨¡å‹é…ç½®æ­£ç¡®
- [x] API ç«¯ç‚¹æ­£ç¡®
- [x] å·¥å…·è°ƒç”¨å…¼å®¹
- [x] æµå¼å¤„ç†æ”¯æŒ
- [x] é”™è¯¯å¤„ç†å®Œå–„

### å¼ºçƒˆå»ºè®®
- [x] API Key éªŒè¯
- [x] æµå¼é”™è¯¯å¤„ç†
- [x] é”™è¯¯æ¶ˆæ¯ä¼˜åŒ–
- [x] å“åº”å¤´æ ‡è®°

### å¯é€‰ä¼˜åŒ–
- [ ] æ€§èƒ½ç›‘æ§
- [ ] å¥åº·æ£€æŸ¥
- [ ] é€Ÿç‡é™åˆ¶
- [ ] ç¼“å­˜ç­–ç•¥

---

## ğŸ“Š é…ç½®å¯¹æ¯”

| æ–¹é¢ | DeepSeek | Gemini | å¤‡æ³¨ |
|------|----------|--------|------|
| æ¨¡å‹åç§° | deepseek-chat | gemini-2.0-flash-exp | éƒ½æ­£ç¡® |
| API ç«¯ç‚¹ | api.deepseek.com | generativelanguage.googleapis.com | éƒ½æ­£ç¡® |
| å·¥å…·è°ƒç”¨ | âœ… æ”¯æŒ | âœ… æ”¯æŒ | å®Œå…¨å…¼å®¹ |
| æµå¼å¤„ç† | âœ… æ”¯æŒ | âœ… æ”¯æŒ | å®Œå…¨å…¼å®¹ |
| ç³»ç»Ÿæç¤º | âœ… æ”¯æŒ | âœ… æ”¯æŒ | å®Œå…¨å…¼å®¹ |
| é”™è¯¯å¤„ç† | âœ… å®Œå–„ | âœ… å®Œå–„ | éƒ½æœ‰å›é€€ |

---

## ğŸ¯ æ€»ä½“è¯„ä¼°

### å¯é æ€§
- **æ¨¡å‹é…ç½®**: âœ… **æ­£ç¡®å¯é **
- **ç«¯ç‚¹é…ç½®**: âœ… **æ­£ç¡®å¯é **
- **å·¥å…·è°ƒç”¨**: âœ… **å®Œå…¨å…¼å®¹**
- **æµå¼å¤„ç†**: âœ… **å®Œå…¨å…¼å®¹**
- **é”™è¯¯å¤„ç†**: âœ… **å®Œå–„å¯é **

### å®‰å…¨æ€§
- **API Key ç®¡ç†**: âœ… **å®‰å…¨**
- **è®¤è¯æ–¹å¼**: âœ… **å®‰å…¨**
- **é”™è¯¯ä¿¡æ¯**: âœ… **ä¸æ³„éœ²æ•æ„Ÿä¿¡æ¯**

### æ€§èƒ½
- **å“åº”æ—¶é—´**: âœ… **å¯æ¥å—**
- **æµå¼å¤„ç†**: âœ… **æµç•…**
- **å¹¶å‘å¤„ç†**: âœ… **æ”¯æŒ**

### ç”¨æˆ·ä½“éªŒ
- **é”™è¯¯æç¤º**: âœ… **æ¸…æ™°å‹å¥½**
- **è‡ªåŠ¨å›é€€**: âœ… **æ— ç¼åˆ‡æ¢**
- **æ¨¡å‹åˆ‡æ¢**: âœ… **æµç•…**

---

## ğŸ”® æœªæ¥ä¼˜åŒ–æ–¹å‘

### çŸ­æœŸï¼ˆå¯é€‰ï¼‰
- [ ] æ·»åŠ æ€§èƒ½ç›‘æ§
- [ ] æ·»åŠ å¥åº·æ£€æŸ¥
- [ ] æ·»åŠ è¯¦ç»†æ—¥å¿—

### ä¸­æœŸï¼ˆå¯é€‰ï¼‰
- [ ] æ·»åŠ é€Ÿç‡é™åˆ¶
- [ ] æ·»åŠ ç¼“å­˜ç­–ç•¥
- [ ] æ·»åŠ æ¨¡å‹é€‰æ‹©ä¼˜åŒ–

### é•¿æœŸï¼ˆå¯é€‰ï¼‰
- [ ] æ”¯æŒæ›´å¤šæ¨¡å‹
- [ ] æ”¯æŒæ¨¡å‹è‡ªåŠ¨é€‰æ‹©
- [ ] æ”¯æŒæˆæœ¬ä¼˜åŒ–

---

## âœ¨ æœ€ç»ˆç»“è®º

### Gemini é›†æˆçŠ¶æ€

**âœ… å®Œå…¨å¯ç”¨ï¼Œé…ç½®æ­£ç¡®å¯é **

### å…³é”®ç‰¹æ€§
1. âœ… æ¨¡å‹é…ç½®æ­£ç¡®
2. âœ… ç«¯ç‚¹é…ç½®æ­£ç¡®
3. âœ… å·¥å…·è°ƒç”¨å…¼å®¹
4. âœ… æµå¼å¤„ç†æ”¯æŒ
5. âœ… é”™è¯¯å¤„ç†å®Œå–„
6. âœ… è‡ªåŠ¨å›é€€æœºåˆ¶
7. âœ… ç”¨æˆ·å‹å¥½çš„é”™è¯¯æ¶ˆæ¯

### å»ºè®®
1. **ç«‹å³éƒ¨ç½²** - é…ç½®å·²å®Œæˆï¼Œå¯ä»¥å®‰å…¨éƒ¨ç½²
2. **ç›‘æ§è¿è¡Œ** - éƒ¨ç½²åç›‘æ§æ€§èƒ½å’Œé”™è¯¯
3. **æ”¶é›†åé¦ˆ** - æ ¹æ®ç”¨æˆ·åé¦ˆè¿›è¡Œä¼˜åŒ–

### é£é™©è¯„çº§
- **ä½é£é™©** âœ… - é…ç½®å®Œå–„ï¼Œæœ‰å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œå›é€€æœºåˆ¶

---

## ğŸ“ æ”¯æŒä¿¡æ¯

### å¸¸è§é—®é¢˜

**Q: Gemini å’Œ DeepSeek æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ**
A: 
- Gemini: Google çš„æœ€æ–°æ¨¡å‹ï¼Œæ€§èƒ½å¼ºå¤§ï¼Œæ”¯æŒå¤šæ¨¡æ€
- DeepSeek: å¼€æºæ¨¡å‹ï¼Œæˆæœ¬ä½ï¼Œå“åº”å¿«
- ä¸¤è€…éƒ½æ”¯æŒå·¥å…·è°ƒç”¨å’Œæµå¼å¤„ç†

**Q: å¦‚ä½•é€‰æ‹©ä½¿ç”¨å“ªä¸ªæ¨¡å‹ï¼Ÿ**
A: 
- é»˜è®¤ä½¿ç”¨ DeepSeekï¼ˆæˆæœ¬ä½ï¼‰
- ç”¨æˆ·å¯ä»¥æ‰‹åŠ¨åˆ‡æ¢åˆ° Gemini
- é€‰æ‹©ä¼šè‡ªåŠ¨ä¿å­˜åˆ° localStorage

**Q: å¦‚æœ Gemini API Key ç¼ºå¤±ä¼šæ€æ ·ï¼Ÿ**
A: 
- è‡ªåŠ¨å›é€€åˆ° DeepSeek
- ç”¨æˆ·ä½“éªŒä¸å—å½±å“
- æœåŠ¡å™¨æ—¥å¿—ä¼šè®°å½•è­¦å‘Š

**Q: ä¸¤ä¸ªæ¨¡å‹å¯ä»¥åŒæ—¶ä½¿ç”¨å—ï¼Ÿ**
A: 
- å¯ä»¥ï¼Œä¸åŒç”¨æˆ·å¯ä»¥ä½¿ç”¨ä¸åŒæ¨¡å‹
- æ¨¡å‹é€‰æ‹©æ˜¯ç‹¬ç«‹çš„
- å®Œå…¨æ”¯æŒå¹¶å‘ä½¿ç”¨

### è·å–å¸®åŠ©

1. æŸ¥çœ‹ `doc/GEMINI-TESTING-GUIDE.md` è¿›è¡Œæµ‹è¯•
2. æŸ¥çœ‹ `doc/GEMINI-CONFIGURATION-AUDIT.md` äº†è§£è¯¦ç»†é…ç½®
3. æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—æ’æŸ¥é—®é¢˜
4. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°æŸ¥çœ‹å®¢æˆ·ç«¯é”™è¯¯

