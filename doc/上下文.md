# Project Spec: AI-Powered Game Operations Center (GOC)

## 1. 项目愿景 (Project Vision)
构建一个**“多人游戏战术指挥中心”**。
核心是为了解决多人联机游戏（如《饥荒》、《悲剧轮回》）中信息不同步、策略决策困难的问题。
通过 AI 战术顾问 (Nexus AI) 提供实时分析和建议。

## 2. 核心架构 (Architecture)
*   **状态流 (State Stream):** Liveblocks (负责 Todo、笔记、聊天记录的实时同步)。
*   **智能流 (Intelligence Stream):** DeepSeek (通过 Vercel AI SDK 集成，支持工具调用)。
*   **媒体流 (Media Stream):** OSS 图片共享 (替代不稳定的 P2P 屏幕共享)。

## 3. 当前进度 (Current Status) - 2025/12/10

### ✅ 已完成 (Phase 1: Infrastructure & Intelligence)
1.  **基础架构:**
    *   Next.js App Router 搭建完成。
    *   Liveblocks 鉴权与房间连接 (`/api/liveblocks-auth`)。
    *   三栏式全屏布局 (Tactical Board, Command Center, Viewport)。

2.  **战术板 (Tactical Board):**
    *   **实时待办 (Todos):** 支持添加、完成（分页显示）、删除。支持 AI 自动添加。
    *   **多人笔记 (Notes):** 支持多标签页（共享笔记、个人笔记、他人笔记）。支持 AI 自动修改。

3.  **指挥中心 (Command Center):**
    *   **AI 集成:** 接入 DeepSeek (`deepseek-chat`)。
    *   **上下文感知:** AI 自动读取“战场笔记”作为 System Prompt 上下文。
    *   **工具能力:** AI 可通过特殊指令 (`<<<UPDATE_NOTES>>>`, `<<<ADD_TODO>>>`) 操控战术板。
    *   **持久化:** 聊天记录同步存储于 Liveblocks，支持后入场查看。
    *   **体验优化:** 支持 Markdown 渲染（暗色主题），防止表单刷新，中文回复强制。

4.  **视口 (Viewport):**
    *   基础占位 UI。
    *   明确了 Phase 2 将放弃 P2P 屏幕共享，转为 OSS 图片共享。

### 🚧 进行中 (Phase 2: Visuals & Media)
1.  **图片共享 (Image Sharing):**
    *   利用阿里云 OSS 存储图片。
    *   Liveblocks 同步图片 URL 列表。
    *   实现图片上传与画廊展示。

## 4. 数据结构 (Data Schema)

**Liveblocks Storage:**
```typescript
type Storage = {
  todos: LiveList<{ id, text, completed }>;
  notes: string; // Shared
  playerNotes: LiveMap<string, string>; // Private/Public slots
  messages: LiveList<{ id, role, content, createdAt }>; // Chat history
  // Planned for Phase 2:
  // sharedImages: LiveList<{ id, url, uploadedBy, createdAt }>;
};
```

## 5. 待办事项 (Next Steps)
1.  **OSS 集成:** 检查 `lib/oss-utils.ts` 可用性。
2.  **UI 实现:** 在 Viewport 添加上传按钮和图片列表。
3.  **AI 增强:** 允许 AI 访问图片链接或通过指令分享图片。
