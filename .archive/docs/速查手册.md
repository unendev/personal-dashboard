# 技术细节速查手册

> **使用说明**：面试前快速浏览，面试时打开这个文档备查。不用全记住，知道在哪里查就行。

---

## 🗺️ 项目整体架构图

```
Project Nexus
│
├── 前端层 (Next.js 15 + React 19)
│   ├── 页面路由 (App Router)
│   ├── UI 组件 (React Components)
│   └── 状态管理 (React Hooks)
│
├── API 层 (Next.js API Routes)
│   ├── RESTful 接口
│   └── 数据验证 (Zod)
│
├── 数据层
│   ├── PostgreSQL (数据库)
│   ├── Prisma (ORM)
│   └── 外部服务 (OSS, AI API)
│
└── 部署层
    ├── Vercel (前端 + API)
    └── Neon (数据库托管)
```

---

## 📁 项目目录结构速查

### 核心目录

```
project-nexus/
├── app/                    # Next.js App Router
│   ├── api/               # API 路由（后端接口）
│   ├── components/        # React 组件
│   │   ├── features/     # 业务功能组件
│   │   ├── ui/           # 基础 UI 组件
│   │   ├── shared/       # 共享组件
│   │   └── layout/       # 布局组件
│   ├── (页面目录)/       # 各个页面
│   └── layout.tsx        # 根布局
├── lib/                   # 工具库
├── prisma/               # 数据库 Schema
└── public/               # 静态资源
```

### 快速定位文件

**找某个功能的代码**：
- 页面入口 → `app/(页面名)/page.tsx`
- 功能组件 → `app/components/features/(功能名)/`
- API 接口 → `app/api/(功能名)/route.ts`
- 数据模型 → `prisma/schema.prisma`

---

## 🎯 三大核心功能详解

### 功能 1：AI 日报（LinuxDo/Reddit）

#### 组件分布

```
主页面：app/page.tsx
  └── ScrollableLayout
      ├── LinuxDoWidget    (显示 LinuxDo 日报)
      └── RedditWidget     (显示 Reddit 日报)

详情弹窗：
  ├── LinuxDoModal         (详细报告)
  └── RedditModal          (详细报告)

API 接口：
  ├── /api/linuxdo         (获取 LinuxDo 数据)
  ├── /api/linuxdo/dates   (获取可用日期)
  ├── /api/reddit          (获取 Reddit 数据)
  └── /api/reddit/dates    (获取可用日期)
```

#### 技术实现

**数据流**：
```
Python 爬虫 (外部) 
  → 写入 PostgreSQL (posts/reddit_posts 表)
    → Next.js API Routes 读取
      → React 组件展示
```

**核心文件**：
- `app/components/features/widgets/LinuxDoWidget.tsx` - LinuxDo 卡片
- `app/components/features/widgets/RedditWidget.tsx` - Reddit 卡片
- `app/api/linuxdo/route.ts` - LinuxDo API
- `app/api/reddit/route.ts` - Reddit API

**面试话术**：
> "AI 日报的数据来自 Python 爬虫，
> 我只负责前端展示部分。
> 
> 用 Next.js 的 API Routes 从数据库读取数据，
> 前端用 React 组件渲染，
> 支持日期选择和价值筛选。"

---

### 功能 2：藏宝阁（多模态知识库）

#### 组件分布

```
主页面：app/treasure-pavilion/page.tsx
  └── TreasureList (宝藏列表)
      ├── TwitterStyleCard    (卡片展示)
      ├── TextCard           (文本卡片)
      ├── ImageGalleryCard   (图片卡片)
      ├── MusicCard          (音乐卡片)
      └── TreasureInputModal (创建/编辑弹窗)
          └── DiscordStyleInput (Discord 风格输入)

子页面：
  ├── /treasure-pavilion/articles  (专题文章)
  └── /treasure-pavilion/mindmap   (思维导图)

API 接口：
  ├── /api/treasures      (CRUD 操作)
  └── /api/upload         (图片上传)
```

#### 技术实现

**核心技术栈**：
- **虚拟滚动**：`@tanstack/react-virtual`
- **图片存储**：阿里云 OSS
- **Markdown**：`react-markdown` + `remark-gfm`
- **数据库**：Prisma + PostgreSQL

**核心文件**：
- `app/components/features/treasure/TreasureList.tsx` - 列表容器（虚拟滚动）
- `app/components/features/treasure/treasure-input/DiscordStyleInput.tsx` - 输入组件
- `app/api/treasures/route.ts` - CRUD API
- `app/api/upload/route.ts` - 图片上传

**面试话术**：
> "藏宝阁支持三种类型：文本、图片、音乐。
> 
> **虚拟滚动**：用了 `@tanstack/react-virtual`，
> 只渲染可见区域，1000+ 数据也不卡。
> 
> **图片上传**：用阿里云 OSS 存储，
> 前端压缩后上传，返回 CDN URL。
> 
> **输入体验**：模仿 Discord，
> 支持 Markdown、拖拽上传、实时预览。"

---

### 功能 3：任务管理（计时器）

#### 组件分布

```
主页面：app/timer/page.tsx 或 app/log/page.tsx
  └── NestedTimerZone (嵌套任务区域)
      └── SortableTaskItem (单个任务卡片)
          └── NestedTimerZone (递归渲染子任务)

辅助组件：
  ├── CategoryZoneWrapper  (分类分组)
  ├── QuickCreateDialog    (快速创建)
  └── TimerWidget          (小部件)

API 接口：
  └── /api/timer-tasks     (任务 CRUD)
```

#### 技术实现

**核心技术**：
- **递归组件**：NestedTimerZone 渲染自己
- **拖拽排序**：`@dnd-kit/core` + `@dnd-kit/sortable`
- **实时计时**：`useEffect` + `setInterval`
- **乐观更新**：临时 ID → 后台保存 → 替换真实 ID

**核心文件**：
- `app/components/features/timer/NestedTimerZone.tsx` - 递归组件（1320 行）
- `app/api/timer-tasks/route.ts` - 任务 API
- `lib/timer-db.ts` - 数据库操作

**面试话术**：
> "任务管理支持无限层级嵌套。
> 
> **递归组件**：NestedTimerZone 渲染自己来实现嵌套。
> 
> **拖拽优化**：
> - 移动端延迟 150ms（防误触）
> - 容差 8px（容错）
> - 手柄 44px（iOS 最小触摸目标）
> 
> **实时计时**：
> - 前端每秒刷新显示
> - 后台异步保存到数据库"

---

## 📊 页面路由速查表

| 路径 | 页面文件 | 功能 | 主要组件 |
|------|---------|------|----------|
| `/` | `app/page.tsx` | 主页 | ScrollableLayout |
| `/dashboard` | `app/dashboard/page.tsx` | 仪表盘 | SkillCard, QuestCard |
| `/timer` | `app/timer/page.tsx` | 计时器 | NestedTimerZone |
| `/log` | `app/log/page.tsx` | 日志 | CreateLogForm, LogCard |
| `/tools` | `app/tools/page.tsx` | 任务清单 | TodoList |
| `/treasure-pavilion` | `app/treasure-pavilion/page.tsx` | 藏宝阁 | TreasureList |
| `/treasure-pavilion/articles` | `app/treasure-pavilion/articles/page.tsx` | 专题 | ArticleWorkspace |
| `/milestones` | `app/milestones/page.tsx` | 里程碑 | Milestone 组件 |
| `/progress` | `app/progress/page.tsx` | 进度统计 | ECharts 图表 |

---

## 🔌 API 接口速查表

### 核心 API

| 接口路径 | 方法 | 功能 | 文件位置 |
|---------|------|------|---------|
| `/api/timer-tasks` | GET | 获取任务列表 | `app/api/timer-tasks/route.ts` |
| `/api/timer-tasks` | POST | 创建任务 | 同上 |
| `/api/timer-tasks` | PUT | 更新任务 | 同上 |
| `/api/timer-tasks` | DELETE | 删除任务 | 同上 |
| `/api/treasures` | GET | 获取宝藏列表 | `app/api/treasures/route.ts` |
| `/api/upload` | POST | 上传图片 | `app/api/upload/route.ts` |
| `/api/linuxdo` | GET | LinuxDo 数据 | `app/api/linuxdo/route.ts` |
| `/api/reddit` | GET | Reddit 数据 | `app/api/reddit/route.ts` |

### API 基本结构

```typescript
// app/api/xxx/route.ts

import { NextRequest, NextResponse } from 'next/server';
import { prisma } from '@/lib/prisma';

export async function GET(request: NextRequest) {
  // 1. 获取参数
  const { searchParams } = new URL(request.url);
  const param = searchParams.get('param');
  
  // 2. 查询数据库
  const data = await prisma.xxx.findMany({ where: { ... } });
  
  // 3. 返回 JSON
  return NextResponse.json(data);
}
```

---

## 🗄️ 数据库表结构速查

### 核心表

| 表名 | 主要字段 | 用途 |
|------|---------|------|
| `users` | id, email, name | 用户信息 |
| `timer_tasks` | id, name, elapsedTime, parentId | 任务计时 |
| `treasures` | id, title, content, type, tags | 宝藏数据 |
| `treasure_images` | id, url, treasureId | 宝藏图片 |
| `posts` | id, title, url, value_assessment | LinuxDo 帖子 |
| `reddit_posts` | id, title, url, subreddit | Reddit 帖子 |
| `todos` | id, text, completed, parentId | 待办事项 |
| `articles` | id, title, content, status | 专题文章 |

### 关键关系

```
User (用户)
  ├── TimerTask (一对多)
  ├── Treasure (一对多)
  ├── Todo (一对多)
  └── Article (一对多)

Treasure (宝藏)
  └── Image (一对多)

TimerTask (任务)
  └── TimerTask (自关联，实现嵌套)

Todo (待办)
  └── Todo (自关联，实现嵌套)
```

---

## 🛠️ 技术栈速查

### 前端

| 技术 | 版本 | 用途 | 在哪里用 |
|------|------|------|----------|
| Next.js | 15.x | 框架 | 整个项目 |
| React | 19.x | UI 库 | 所有组件 |
| TypeScript | 5.x | 类型安全 | 所有代码 |
| Tailwind CSS | 4.x | 样式 | 所有样式 |
| @dnd-kit | 6.x | 拖拽 | NestedTimerZone |
| @tanstack/react-virtual | 3.x | 虚拟滚动 | TreasureList |
| react-markdown | 10.x | Markdown | TextCard |
| @tiptap/react | 3.x | 富文本编辑 | ArticleEditor |

### 后端

| 技术 | 用途 | 在哪里用 |
|------|------|----------|
| Next.js API Routes | 后端接口 | app/api/ |
| Prisma | ORM | lib/prisma.ts |
| PostgreSQL | 数据库 | Neon 托管 |
| Zod | 数据验证 | lib/validations/ |
| NextAuth.js | 认证 | lib/auth.ts |
| 阿里云 OSS | 图片存储 | app/api/upload/ |

### 部署

| 服务 | 用途 |
|------|------|
| Vercel | 前端 + API 部署 |
| Neon | PostgreSQL 数据库托管 |
| 阿里云 OSS | 图片存储 + CDN |

---

## 💡 面试常见技术问题速查

### Q: "Next.js 的 App Router 和 Pages Router 有什么区别？"

**快速回答**：
> "我用的是 App Router（Next.js 13+）：
> - 基于文件系统路由，放在 `app/` 目录
> - 支持 Server Components（默认服务端渲染）
> - 可以在组件里直接 `async/await`
> 
> Pages Router 是老版本，放在 `pages/` 目录。
> 
> 我选 App Router 是因为官方推荐，而且文档更新。"

---

### Q: "你的项目怎么做认证的？"

**快速回答**：
> "用了 NextAuth.js：
> - 支持账号密码登录
> - 支持 Google OAuth
> - Session 存在 JWT 里
> 
> 主要配置在 `lib/auth.ts`。
> 
> 开发模式下用了 `useDevSession` hook，
> 可以自动登录测试账户，方便调试。"

---

### Q: "虚拟滚动是怎么实现的？"

**快速回答**：
> "用了 `@tanstack/react-virtual` 库：
> 
> ```typescript
> const virtualizer = useVirtualizer({
>   count: treasures.length,    // 总数
>   estimateSize: () => 400,    // 估算高度
>   overscan: 5                 // 预渲染 5 个
> });
> ```
> 
> 只渲染可见区域的元素，
> 其他用空白占位，
> 所以 1000+ 数据也不卡。"

---

### Q: "图片上传怎么做的？"

**快速回答**：
> "流程：
> 1. 前端压缩图片（`browser-image-compression`）
> 2. 上传到 `/api/upload` 接口
> 3. API 用阿里云 OSS SDK 上传
> 4. 返回 CDN URL
> 5. 前端保存 URL 到数据库
> 
> 选 OSS 是因为：
> - 不占服务器空间
> - CDN 加速，全球访问快
> - 可靠性高（99.9999999%）"

---

### Q: "递归组件怎么实现的？"

**快速回答**：
> "核心是组件渲染自己：
> 
> ```typescript
> function NestedTimerZone({ tasks, level }) {
>   return tasks.map(task => (
>     <div>
>       <TaskCard task={task} />
>       {task.children && (
>         <NestedTimerZone 
>           tasks={task.children}
>           level={level + 1}  // 层级 +1
>         />
>       )}
>     </div>
>   ));
> }
> ```
> 
> 数据库用 `parentId` 自关联。"

---

### Q: "乐观更新怎么做的？"

**快速回答**：
> "流程：
> 1. 用户操作 → 立即用临时 ID 更新 UI
> 2. 后台异步调用 API
> 3. 成功 → 用真实 ID 替换
> 4. 失败 → 回滚 UI
> 
> 好处：用户感知延迟 = 0
> 坏处：需要处理失败回滚"

---

### Q: "怎么做的移动端优化？"

**快速回答**：
> "主要两个方面：
> 
> 1. **响应式设计**：
>    - Tailwind CSS 的 `sm:` `md:` `lg:` 断点
>    - 移动端单列，桌面端多列
> 
> 2. **触摸优化**：
>    - 拖拽延迟 150ms（防误触）
>    - 按钮最小 44px（iOS 标准）
>    - 震动反馈（`navigator.vibrate`）"

---

## 🚨 可能的难题及应对

### 难题 1："为什么用这个架构？"

**诚实回答**：
> "坦白说，架构设计主要是参考了：
> - Next.js 官方文档的最佳实践
> - 一些开源项目的结构
> 
> 我的重点是**先让功能跑起来**，
> 架构上可能不是最优解。
> 
> 如果入职，我很想学习**如何设计更好的架构**，
> 这也是我来面试的原因。"

---

### 难题 2："如果要优化性能，你会怎么做？"

**诚实回答**：
> "目前我做的优化：
> - 虚拟滚动（大列表）
> - 图片懒加载（Next.js Image）
> - 乐观更新（减少等待）
> 
> 我知道还可以做：
> - 代码分割（动态 import）
> - 缓存策略（SWR / React Query）
> - SSR / ISG（静态生成）
> 
> 但具体怎么权衡，我还在学习。
> 希望在实际项目中深入掌握。"

---

### 难题 3："遇到过什么技术难题？"

**回到真实故事**：
> "（选一个您准备的真实故事讲）
> 
> 其实我的项目没有特别复杂的技术难题，
> 更多是**工程实践**的挑战：
> - 如何组织代码
> - 如何处理错误
> - 如何优化体验
> 
> 我的优势是**能解决实际问题**，
> 不一定要最优雅的方案，但能让功能稳定运行。"

---

## 📌 面试备忘录

### 开场准备

面试官问"介绍一下你的项目"时，打开：
- [ ] 项目 Live Demo（或录屏视频）
- [ ] 这个文档（备查）
- [ ] `prisma/schema.prisma`（展示数据模型）
- [ ] `app/api/treasures/route.ts`（展示 API 代码）

### 关键数字记住

- **代码量**：15,000+ 行
- **组件数**：100+ 个
- **API 端点**：43 个
- **开发时长**：3 个月
- **数据量**：1000+ 条记录
- **使用时长**：稳定运行 3 个月

### 核心优势

面试时要强调的：
1. ✅ **技术栈匹配**：Next.js 15 + React 19 + TypeScript
2. ✅ **独立完成**：从需求到部署全流程
3. ✅ **真实使用**：每天都在用，不是 Demo
4. ✅ **快速学习**：3 个月掌握全栈技术
5. ✅ **问题解决**：遇到问题能独立解决

---

## 🎯 最后提醒

**记住**：
- 这个文档不用全背，知道在哪里查就行
- 面试时可以说"我看一下代码"，不要硬编
- 诚实 > 装懂
- 展示学习能力 > 展示技术深度

**如果被问到不会的**：
> "这个具体实现细节我记不太清了，
> 但我知道在（某个文件）里，
> 可以打开看一下吗？"

然后查这个文档，找到对应部分。

加油！💪

