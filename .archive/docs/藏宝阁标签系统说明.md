# 藏宝阁标签系统说明

## 概述

藏宝阁的标签系统采用**混合模式**设计，完美平衡了易用性和灵活性，解决了传统标签系统的痛点。

## 设计理念

### 核心原则

1. **从"分类"开始，而非"标签"** - 避免标签数量爆炸性增长
2. **低摩擦输入体验** - 减少用户的心智负担
3. **灵活性与一致性平衡** - 既能快速输入，又能保持组织性

### 两层标签体系

#### 1. 主要分类（Primary Categories）

**设计特点：**
- 使用单选按钮组
- 固定的核心标签集（4个）
- 点击即可选择，零思考成本
- 保证分类的一致性

**可用分类：**
- 🌱 **Life** - 生活
- 📚 **Knowledge** - 知识
- 💭 **Thought** - 思考
- 🌳 **Root** - 根源

**使用建议：**
- 90% 的情况下使用这个核心标签集
- 每个宝藏选择 0-1 个主要分类
- 类似 Discord 频道的概念

#### 2. 主题标签（Topic Tags）

**设计特点：**
- 使用带自动补全的输入框
- 支持创建新标签
- 自动提示已存在的标签
- 最多 10 个标签

**交互方式：**
- 输入文字时自动显示匹配的已有标签
- 按 `Enter` 或 `空格` 添加标签
- 按 `Backspace` 删除最后一个标签
- 使用 `↑` `↓` 箭头在建议中选择
- 按 `Escape` 关闭建议列表

**层级标签支持：**
- 使用 `/` 分隔层级，如 `tech/frontend`、`tech/ai`
- 顶层标签数量保持少量
- 实现更精细的分类

## 使用示例

### 示例 1：知识分享

```
主要分类: Knowledge
主题标签: frontend, react, performance
```

**卡片显示效果：**
```
📚  [时间]
    [标题]
    [内容...]
    [frontend] [react] [performance]
```

### 示例 2：生活记录

```
主要分类: Life
主题标签: travel, food, photography
```

**卡片显示效果：**
```
🌱  [时间]
    [标题]
    [图片展示]
    [travel] [food] [photography]
```

### 示例 3：深度思考

```
主要分类: Thought
主题标签: philosophy, wisdom
```

**卡片显示效果：**
```
💭  [时间]
    [标题]
    [内容...]
    [philosophy] [wisdom]
```

### 示例 4：根源探索

```
主要分类: Root
主题标签: origin, essence, fundamental
```

**卡片显示效果：**
```
🌳  [时间]
    [标题]
    [内容...]
    [origin] [essence] [fundamental]
```

注意：层级标签如 `design/ui` 会被智能解析，显示为 `design / ui`，最后一级加粗。

## 技术实现

### 组件架构

```
TreasureInputModal
└── DiscordStyleInput
    ├── PrimaryCategorySelector   (主要分类选择器)
    ├── TagInput                  (主题标签输入)
    └── ImageUploadPreview        (图片预览)
```

### 数据流

1. **标签获取**
   - 组件挂载时从 `/api/treasures/tags` 获取标签建议
   - 标签按使用频率排序
   - 自动补全时过滤已选择的标签

2. **标签提交**
   - 合并主要分类和主题标签：`[primaryCategory, ...topicTags]`
   - 存储到 `Treasure.tags` 字段（String[]）
   - 支持按标签筛选和搜索

3. **标签编辑**
   - 自动识别主要分类（从固定列表）
   - 其余标签作为主题标签
   - 保持原有标签顺序

### API 端点

#### GET /api/treasures/tags
获取用户的所有标签及使用次数

**响应格式：**
```json
[
  { "name": "Tech", "count": 15 },
  { "name": "frontend", "count": 8 },
  { "name": "design/ui", "count": 5 }
]
```

#### GET /api/treasures?tag=xxx
按标签筛选宝藏

#### GET /api/treasures?search=xxx
搜索标题和内容

## 显示设计

### 卡片上的标签显示

宝藏卡片采用**紧凑式布局**，标签与内容自然融合：

#### 头部区域（时间和分类）
```
[时间] • [类型图标] • [主要分类]
```
- 主要分类紧跟在类型图标后，用 `•` 分隔
- 使用蓝紫渐变背景，加粗字体，小巧设计（`py-0.5`）
- 如果没有选择主要分类，则不显示

#### 主题标签区域（媒体内容后）
```
[frontend] [react] [design/ui]
```
- 显示在媒体内容（图片/音乐）之后
- 使用灰白色背景，带 `#` 图标
- **层级标签智能解析**：
  - `design/ui` 会显示为 `design / ui`
  - 路径部分（design）：浅色显示
  - 最终名称（ui）：加粗显示
- 如果没有主题标签，则不显示该区域

### 筛选面板的标签显示

筛选面板中标签也**分区显示**：

1. **主要分类区**
   - 标题："主要分类"
   - 样式：蓝紫渐变按钮
   - 只显示实际使用的主要分类

2. **主题标签区**
   - 标题："主题标签"
   - 样式：灰白色按钮
   - 显示所有非主要分类的标签

## 最佳实践

### 标签命名建议

1. **保持简短** - 使用简短、易记的词语
2. **使用英文** - 避免中文输入的摩擦（可选）
3. **统一格式** - 小写字母，用 `-` 连接多词
4. **层级清晰** - 如 `tech/frontend/react`
5. **层级标签命名规范**：
   - 使用 `/` 分隔层级
   - 推荐 2-3 层，避免过深
   - 例如：`tech/frontend`、`design/ui/figma`
   - 显示时会自动解析，最后一层加粗突出

### 避免的做法

❌ 创建过多相似标签（如 `js`, `javascript`, `JavaScript`）
❌ 每个宝藏使用超过 5 个标签
❌ 使用过于具体的标签（如 `2024-01-15-meeting-notes`）
❌ 忽略主要分类，只使用主题标签

### 推荐的做法

✅ 先选择主要分类，再添加 1-3 个主题标签
✅ 利用自动补全，保持标签一致性
✅ 定期回顾和整理标签（通过筛选面板）
✅ 使用层级标签细分大类别

## 筛选和搜索

### 筛选面板

点击"筛选"按钮可以：
- **按类型筛选**（文本/图片/音乐）
- **按主要分类筛选**（蓝紫渐变按钮，显示所有可用的主要分类）
- **按主题标签筛选**（灰白色按钮，显示所有可用的主题标签）
- 清除所有筛选条件

筛选面板将主要分类和主题标签**分开显示**，便于快速定位想要查看的内容。

### 搜索功能

搜索框支持：
- 标题搜索（不区分大小写）
- 内容搜索（不区分大小写）
- 实时搜索（无需按回车）

## 未来扩展

### 可能的增强功能

1. **标签别名** - 支持标签别名映射（如 `js` → `javascript`）
2. **标签合并** - 批量合并相似标签
3. **标签统计** - 可视化标签使用情况
4. **智能建议** - 基于内容的标签推荐
5. **标签分组** - 标签的分组管理

## 参考资料

- [人生阁标签系统设计文档](../human.md)
- Discord 频道设计理念
- Tag 输入组件最佳实践

