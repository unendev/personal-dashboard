# è®¡æ—¶å™¨æ¨¡å—é‡æ„è®¡åˆ’

> **ç‰ˆæœ¬**: v1.0  
> **åˆ›å»ºæ—¥æœŸ**: 2025-10-29  
> **ç›®æ ‡**: å°†å·¨æ— éœ¸ç»„ä»¶é‡æ„ä¸ºæ¨¡å—åŒ–ã€å¯ç»´æŠ¤çš„æ¶æ„

---

## ğŸ“‹ ç›®å½•

- [å½“å‰é—®é¢˜åˆ†æ](#å½“å‰é—®é¢˜åˆ†æ)
- [é‡æ„åŸåˆ™](#é‡æ„åŸåˆ™)
- [ç›®æ ‡æ¶æ„](#ç›®æ ‡æ¶æ„)
- [åˆ†é˜¶æ®µæ‰§è¡Œè®¡åˆ’](#åˆ†é˜¶æ®µæ‰§è¡Œè®¡åˆ’)
- [é£é™©è¯„ä¼°ä¸å›æ»šç­–ç•¥](#é£é™©è¯„ä¼°ä¸å›æ»šç­–ç•¥)
- [æˆåŠŸæ ‡å‡†](#æˆåŠŸæ ‡å‡†)

---

## å½“å‰é—®é¢˜åˆ†æ

### ğŸ”´ æ ¸å¿ƒé—®é¢˜

| é—®é¢˜ | å½“å‰çŠ¶æ€ | å½±å“ | ä¼˜å…ˆçº§ |
|------|---------|------|--------|
| **è¶…å¤§ç»„ä»¶** | NestedTimerZone.tsx (1035è¡Œ) | éš¾ä»¥ç»´æŠ¤ã€bugå¤š | P0 |
| **é€»è¾‘åˆ†æ•£** | è·¨ 4+ æ–‡ä»¶é‡å¤é€»è¾‘ | ä¿®æ”¹å›°éš¾ã€ä¸ä¸€è‡´ | P0 |
| **Props Drilling** | 19+ ä¸ª props å±‚å±‚ä¼ é€’ | æ€§èƒ½å·®ã€éš¾è¿½è¸ª | P1 |
| **çŠ¶æ€æ··ä¹±** | é‡å¤çš„ state å®šä¹‰ | æ•°æ®ä¸ä¸€è‡´ | P0 |
| **API ä¸ä¸€è‡´** | å‰åç«¯è„±èŠ‚ | åŠŸèƒ½å¤±æ•ˆ | P0 (å·²ä¿®å¤) |

### ğŸ“Š ä»£ç åº¦é‡

```
app/components/features/timer/
â”œâ”€â”€ NestedTimerZone.tsx          1,035 è¡Œ ğŸš¨ (ç›®æ ‡: <300è¡Œ)
â”œâ”€â”€ CategoryZoneWrapper.tsx        186 è¡Œ âš ï¸  (å¯æ¥å—)
â”œâ”€â”€ CategoryZoneHeader.tsx          ~80 è¡Œ âœ…
â””â”€â”€ QuickCreateDialog.tsx          ~150 è¡Œ âœ…

app/hooks/
â””â”€â”€ useTimerControl.ts             450 è¡Œ âš ï¸  (ç›®æ ‡: <300è¡Œ)

app/log/
â””â”€â”€ page.tsx                     1,300+ è¡Œ ğŸš¨ (ç›®æ ‡: <500è¡Œ)
```

### ğŸ¯ å…³é”®æŒ‡æ ‡

- **ç»„ä»¶å¤æ‚åº¦**: NestedTimerZone (åœˆå¤æ‚åº¦ > 50)
- **Props æ•°é‡**: 19 ä¸ªï¼ˆæ¨è < 8ï¼‰
- **æ–‡ä»¶è¡Œæ•°**: å¹³å‡ 500 è¡Œï¼ˆæ¨è < 300ï¼‰
- **ä¾èµ–æ·±åº¦**: 5 å±‚ï¼ˆæ¨è < 3ï¼‰

---

## é‡æ„åŸåˆ™

### ğŸ’ æ ¸å¿ƒåŸåˆ™

1. **å•ä¸€èŒè´£åŸåˆ™ (SRP)**
   - ä¸€ä¸ªç»„ä»¶/å‡½æ•°åªåšä¸€ä»¶äº‹
   - æ–‡ä»¶è¡Œæ•° < 300

2. **æ¥å£éš”ç¦»åŸåˆ™ (ISP)**
   - Props æ•°é‡ < 8
   - é¿å…ä¼ é€’æ•´ä¸ªå¯¹è±¡

3. **ä¾èµ–å€’ç½®åŸåˆ™ (DIP)**
   - ä¾èµ–æŠ½è±¡ï¼ˆæ¥å£ï¼‰ï¼Œä¸ä¾èµ–å…·ä½“å®ç°
   - ä½¿ç”¨ Context/Hook è€Œé Props

4. **å¼€é—­åŸåˆ™ (OCP)**
   - å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å°é—­
   - é€šè¿‡ç»„åˆè€Œéä¿®æ”¹æ·»åŠ åŠŸèƒ½

### ğŸš« åæ¨¡å¼é¿å…

```typescript
// âŒ é¿å…ï¼šå·¨æ— éœ¸ç»„ä»¶
function MegaComponent({ prop1, prop2, ..., prop19 }) {
  // 1000+ è¡Œä»£ç 
}

// âœ… æ¨èï¼šå°ç»„ä»¶ + ç»„åˆ
function Container() {
  const state = useTimerState();
  return <TaskList tasks={state.tasks} />;
}
```

---

## ç›®æ ‡æ¶æ„

### ğŸ—ï¸ æ–°ç›®å½•ç»“æ„

```
app/features/timer/
â”œâ”€â”€ types/
â”‚   â”œâ”€â”€ timer.types.ts           # æ ¸å¿ƒç±»å‹å®šä¹‰ (~50è¡Œ)
â”‚   â”œâ”€â”€ api.types.ts             # API è¯·æ±‚/å“åº”ç±»å‹ (~50è¡Œ)
â”‚   â””â”€â”€ index.ts                 # ç»Ÿä¸€å¯¼å‡º
â”‚
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ useTimerState.ts         # çŠ¶æ€ç®¡ç† (~150è¡Œ)
â”‚   â”œâ”€â”€ useTimerAPI.ts           # API è°ƒç”¨å±‚ (~200è¡Œ)
â”‚   â”œâ”€â”€ useTimerControl.ts       # å·²æœ‰ï¼Œéœ€æ‹†åˆ† (~450è¡Œ â†’ ~200è¡Œ)
â”‚   â””â”€â”€ useTimerDragDrop.ts      # æ‹–æ‹½é€»è¾‘ (~100è¡Œ)
â”‚
â”œâ”€â”€ context/
â”‚   â””â”€â”€ TimerContext.tsx         # å…¨å±€çŠ¶æ€ Context (~100è¡Œ)
â”‚
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ TimerTask/
â”‚   â”‚   â”œâ”€â”€ TimerTask.tsx        # å•ä¸ªä»»åŠ¡ç»„ä»¶ (~150è¡Œ)
â”‚   â”‚   â”œâ”€â”€ TimerControls.tsx   # æ§åˆ¶æŒ‰é’® (~80è¡Œ)
â”‚   â”‚   â””â”€â”€ TimerProgress.tsx   # è¿›åº¦æ˜¾ç¤º (~60è¡Œ)
â”‚   â”‚
â”‚   â”œâ”€â”€ TimerTaskList/
â”‚   â”‚   â”œâ”€â”€ TimerTaskList.tsx   # ä»»åŠ¡åˆ—è¡¨ (~120è¡Œ)
â”‚   â”‚   â””â”€â”€ TaskSortable.tsx    # å¯æ’åºåŒ…è£… (~80è¡Œ)
â”‚   â”‚
â”‚   â”œâ”€â”€ TimerCategory/
â”‚   â”‚   â”œâ”€â”€ CategoryHeader.tsx  # åˆ†ç±»å¤´éƒ¨ (~80è¡Œ)
â”‚   â”‚   â””â”€â”€ CategoryZone.tsx    # åˆ†ç±»åŒºåŸŸ (~150è¡Œ)
â”‚   â”‚
â”‚   â””â”€â”€ TimerDialog/
â”‚       â”œâ”€â”€ AddTaskDialog.tsx   # æ·»åŠ ä»»åŠ¡ (~100è¡Œ)
â”‚       â””â”€â”€ EditTaskDialog.tsx  # ç¼–è¾‘ä»»åŠ¡ (~100è¡Œ)
â”‚
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ timeFormat.ts            # æ—¶é—´æ ¼å¼åŒ– (~50è¡Œ)
â”‚   â”œâ”€â”€ taskCalculations.ts     # ä»»åŠ¡è®¡ç®— (~80è¡Œ)
â”‚   â””â”€â”€ validation.ts            # æ•°æ®éªŒè¯ (~60è¡Œ)
â”‚
â””â”€â”€ api/
    â””â”€â”€ timerAPI.ts              # ç»Ÿä¸€çš„ API è°ƒç”¨ (~200è¡Œ)
```

### ğŸ“ æ¶æ„å±‚æ¬¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Page Layer                 â”‚  /log/page.tsx
â”‚  - è·¯ç”±                             â”‚  (~300è¡Œ)
â”‚  - å¸ƒå±€                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       Feature Layer                 â”‚  
â”‚  - TimerContext (çŠ¶æ€)              â”‚  features/timer/
â”‚  - ä¸šåŠ¡ç»„ä»¶ç»„åˆ                      â”‚  (~1200è¡Œ â†’ å¤šæ–‡ä»¶)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Component Layer                â”‚
â”‚  - çº¯ UI ç»„ä»¶                        â”‚  components/
â”‚  - å¯å¤ç”¨                           â”‚  (~800è¡Œ)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Hook Layer                   â”‚
â”‚  - useTimerState                    â”‚  hooks/
â”‚  - useTimerAPI                      â”‚  (~600è¡Œ)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         API Layer                   â”‚
â”‚  - timerAPI.ts                      â”‚  api/
â”‚  - ç»Ÿä¸€çš„ç½‘ç»œè¯·æ±‚                    â”‚  (~200è¡Œ)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## åˆ†é˜¶æ®µæ‰§è¡Œè®¡åˆ’

### ğŸ¯ Phase 1: ç±»å‹å®šä¹‰ä¸ API å±‚ (1-2å¤©)

**ç›®æ ‡**: å»ºç«‹æ¸…æ™°çš„æ¥å£å¥‘çº¦

#### Step 1.1: æå–ç±»å‹å®šä¹‰

**æ–‡ä»¶**: `app/features/timer/types/timer.types.ts`

```typescript
/**
 * ä»»åŠ¡çŠ¶æ€æšä¸¾
 */
export enum TaskStatus {
  IDLE = 'idle',
  RUNNING = 'running',
  PAUSED = 'paused',
  COMPLETED = 'completed'
}

/**
 * è®¡æ—¶å™¨ä»»åŠ¡æ ¸å¿ƒæ¥å£
 */
export interface TimerTask {
  id: string;
  name: string;
  categoryPath: string;
  instanceTag?: string | null;
  elapsedTime: number;
  initialTime: number;
  isRunning: boolean;
  startTime: number | null;
  isPaused: boolean;
  pausedTime: number;
  parentId?: string | null;
  children?: TimerTask[];
  order?: number;
  version?: number;
  createdAt: string;
  updatedAt: string;
}

/**
 * ä»»åŠ¡æ“ä½œå›è°ƒ
 */
export interface TimerCallbacks {
  onStart?: (taskId: string) => void;
  onPause?: (taskId: string) => void;
  onStop?: (taskId: string) => void;
  onChange?: (tasks: TimerTask[]) => void;
}
```

**æ“ä½œ**:
- [ ] åˆ›å»º `types/timer.types.ts`
- [ ] åˆ›å»º `types/api.types.ts`
- [ ] åˆ›å»º `types/index.ts` (ç»Ÿä¸€å¯¼å‡º)
- [ ] æ›´æ–°æ‰€æœ‰æ–‡ä»¶çš„ import

**éªŒè¯**:
```bash
# ç±»å‹æ£€æŸ¥é€šè¿‡
npm run type-check
```

---

#### Step 1.2: ç»Ÿä¸€ API å±‚

**æ–‡ä»¶**: `app/features/timer/api/timerAPI.ts`

```typescript
import type { TimerTask } from '../types';

/**
 * è®¡æ—¶å™¨ API ç»Ÿä¸€è°ƒç”¨å±‚
 */
export const timerAPI = {
  /**
   * è·å–ä»»åŠ¡åˆ—è¡¨
   */
  async getTasks(userId: string, date: string): Promise<TimerTask[]> {
    const response = await fetch(`/api/timer-tasks?userId=${userId}&date=${date}`);
    if (!response.ok) throw new Error('Failed to fetch tasks');
    return response.json();
  },

  /**
   * å¯åŠ¨ä»»åŠ¡
   */
  async startTask(taskId: string, version?: number): Promise<TimerTask> {
    const response = await fetch('/api/timer-tasks', {
      method: 'PUT',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        id: taskId,
        version,
        isRunning: true,
        isPaused: false,
        startTime: Math.floor(Date.now() / 1000),
        pausedTime: 0
      })
    });
    if (!response.ok) {
      const error = await response.json();
      throw new Error(error.message || 'Failed to start task');
    }
    return response.json();
  },

  /**
   * æš‚åœä»»åŠ¡
   */
  async pauseTask(
    taskId: string, 
    elapsedTime: number, 
    version?: number
  ): Promise<TimerTask> {
    const response = await fetch('/api/timer-tasks', {
      method: 'PUT',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        id: taskId,
        version,
        elapsedTime,
        isPaused: true,
        isRunning: false,
        startTime: null,
        pausedTime: 0
      })
    });
    if (!response.ok) {
      const error = await response.json();
      throw new Error(error.message || 'Failed to pause task');
    }
    return response.json();
  },

  // ... å…¶ä»– API æ–¹æ³•
};
```

**æ“ä½œ**:
- [ ] åˆ›å»º `api/timerAPI.ts`
- [ ] ä» `useTimerControl.ts` æå–æ‰€æœ‰ API è°ƒç”¨
- [ ] æ·»åŠ é”™è¯¯å¤„ç†å’Œé‡è¯•é€»è¾‘
- [ ] æ·»åŠ ç±»å‹å®‰å…¨çš„è¯·æ±‚/å“åº”

**éªŒè¯**:
```typescript
// æµ‹è¯• API è°ƒç”¨
import { timerAPI } from './api/timerAPI';

const tasks = await timerAPI.getTasks('user-1', '2025-10-29');
console.log(tasks); // åº”è¿”å› TimerTask[]
```

---

### ğŸ¯ Phase 2: æ‹†åˆ† NestedTimerZone (2-3å¤©)

**ç›®æ ‡**: 1035 è¡Œ â†’ 150 è¡Œ

#### Step 2.1: æå– TimerTask ç»„ä»¶

**æ–‡ä»¶**: `app/features/timer/components/TimerTask/TimerTask.tsx`

```typescript
import { TimerControls } from './TimerControls';
import { TimerProgress } from './TimerProgress';
import type { TimerTask as Task } from '../../types';

interface TimerTaskProps {
  task: Task;
  onStart: (id: string) => void;
  onPause: (id: string) => void;
  onStop: (id: string) => void;
  isLocked?: boolean;
}

export function TimerTask({ 
  task, 
  onStart, 
  onPause, 
  onStop,
  isLocked 
}: TimerTaskProps) {
  return (
    <div className="timer-task">
      <div className="task-header">
        <h3>{task.name}</h3>
        <TimerProgress 
          elapsedTime={task.elapsedTime}
          initialTime={task.initialTime}
        />
      </div>
      
      <TimerControls
        task={task}
        onStart={onStart}
        onPause={onPause}
        onStop={onStop}
        disabled={isLocked}
      />
      
      {/* å­ä»»åŠ¡é€’å½’æ¸²æŸ“ */}
      {task.children?.map(child => (
        <TimerTask
          key={child.id}
          task={child}
          onStart={onStart}
          onPause={onPause}
          onStop={onStop}
          isLocked={isLocked}
        />
      ))}
    </div>
  );
}
```

**æ“ä½œ**:
- [ ] åˆ›å»º `TimerTask.tsx` (~150è¡Œ)
- [ ] åˆ›å»º `TimerControls.tsx` (~80è¡Œ)
- [ ] åˆ›å»º `TimerProgress.tsx` (~60è¡Œ)
- [ ] ä» NestedTimerZone æå–æ¸²æŸ“é€»è¾‘

**éªŒè¯**:
- [ ] æ‰€æœ‰æŒ‰é’®åŠŸèƒ½æ­£å¸¸
- [ ] å­ä»»åŠ¡æ­£ç¡®é€’å½’æ˜¾ç¤º
- [ ] æ ·å¼ä¿æŒä¸€è‡´

---

#### Step 2.2: æå–æ‹–æ‹½é€»è¾‘

**æ–‡ä»¶**: `app/features/timer/hooks/useTimerDragDrop.ts`

```typescript
import { useSensor, useSensors, PointerSensor } from '@dnd-kit/core';
import type { TimerTask } from '../types';

export function useTimerDragDrop(
  tasks: TimerTask[],
  onTasksChange: (tasks: TimerTask[]) => void
) {
  const sensors = useSensors(
    useSensor(PointerSensor, {
      activationConstraint: {
        distance: 8,
      },
    })
  );

  const handleDragEnd = (event: DragEndEvent) => {
    // æ‹–æ‹½é€»è¾‘
  };

  return {
    sensors,
    handleDragEnd
  };
}
```

**æ“ä½œ**:
- [ ] åˆ›å»º `useTimerDragDrop.ts`
- [ ] ä» NestedTimerZone æå–æ‰€æœ‰ dnd-kit é€»è¾‘
- [ ] æµ‹è¯•æ‹–æ‹½æ’åº

---

#### Step 2.3: é‡æ„ NestedTimerZone

**æ–‡ä»¶**: `app/components/features/timer/NestedTimerZone.tsx` (é‡æ„å)

```typescript
import { useTimerDragDrop } from '@/app/features/timer/hooks/useTimerDragDrop';
import { TimerTaskList } from '@/app/features/timer/components/TimerTaskList';
import { DndContext } from '@dnd-kit/core';

export default function NestedTimerZone({ tasks, onTasksChange, ...props }: Props) {
  const { sensors, handleDragEnd } = useTimerDragDrop(tasks, onTasksChange);
  const timerControl = useTimerControl({ tasks, onTasksChange, ...callbacks });

  return (
    <DndContext sensors={sensors} onDragEnd={handleDragEnd}>
      <TimerTaskList
        tasks={tasks}
        timerControl={timerControl}
        {...props}
      />
    </DndContext>
  );
}
```

**æ“ä½œ**:
- [ ] é‡å†™ NestedTimerZone (ç›®æ ‡: ~150è¡Œ)
- [ ] ç»„åˆä½¿ç”¨æ–°çš„å­ç»„ä»¶
- [ ] ä¿æŒ Props æ¥å£å…¼å®¹ï¼ˆå‘åå…¼å®¹ï¼‰

**éªŒè¯**:
```bash
# ç¡®ä¿æ‰€æœ‰åŠŸèƒ½æ­£å¸¸
# - å¯åŠ¨/æš‚åœ/åœæ­¢
# - æ‹–æ‹½æ’åº
# - å­ä»»åŠ¡å±•å¼€/æŠ˜å 
# - ç‰ˆæœ¬å†²çªå¤„ç†
```

---

### ğŸ¯ Phase 3: Context çŠ¶æ€ç®¡ç† (1-2å¤©)

**ç›®æ ‡**: æ¶ˆé™¤ Props Drilling

#### Step 3.1: åˆ›å»º TimerContext

**æ–‡ä»¶**: `app/features/timer/context/TimerContext.tsx`

```typescript
import { createContext, useContext, useState, useCallback } from 'react';
import type { TimerTask, TimerCallbacks } from '../types';
import { useTimerControl } from '../hooks/useTimerControl';

interface TimerContextValue {
  tasks: TimerTask[];
  setTasks: (tasks: TimerTask[]) => void;
  startTimer: (id: string) => Promise<void>;
  pauseTimer: (id: string) => Promise<void>;
  stopTimer: (id: string) => Promise<void>;
  operationInProgress: Set<string>;
}

const TimerContext = createContext<TimerContextValue | null>(null);

export function TimerProvider({ 
  children, 
  initialTasks = [],
  onVersionConflict,
  onTasksPaused
}: {
  children: React.ReactNode;
  initialTasks?: TimerTask[];
  onVersionConflict?: () => void;
  onTasksPaused?: (tasks: Array<{ id: string; name: string }>) => void;
}) {
  const [tasks, setTasks] = useState<TimerTask[]>(initialTasks);

  const timerControl = useTimerControl({
    tasks,
    onTasksChange: setTasks,
    onVersionConflict,
    onTasksPaused
  });

  return (
    <TimerContext.Provider value={{ tasks, setTasks, ...timerControl }}>
      {children}
    </TimerContext.Provider>
  );
}

export function useTimer() {
  const context = useContext(TimerContext);
  if (!context) {
    throw new Error('useTimer must be used within TimerProvider');
  }
  return context;
}
```

**æ“ä½œ**:
- [ ] åˆ›å»º `context/TimerContext.tsx`
- [ ] åœ¨ `/log/page.tsx` åŒ…è£¹ `<TimerProvider>`
- [ ] å­ç»„ä»¶ä½¿ç”¨ `useTimer()` æ›¿ä»£ props

**éªŒè¯**:
- [ ] å­ç»„ä»¶æ— éœ€ä¼ é€’å¤§é‡ props
- [ ] çŠ¶æ€é›†ä¸­ç®¡ç†
- [ ] æ€§èƒ½æµ‹è¯•ï¼ˆæ— é¢å¤–æ¸²æŸ“ï¼‰

---

### ğŸ¯ Phase 4: ä¼˜åŒ– /log/page.tsx (1å¤©)

**ç›®æ ‡**: 1300+ è¡Œ â†’ ~300 è¡Œ

#### Step 4.1: æå–é¡µé¢åŒºå—

```typescript
// components/LogPage/TimerSection.tsx
export function TimerSection({ date }: { date: string }) {
  const { tasks } = useTimer();
  return (
    <section>
      <CategoryZoneWrapper tasks={tasks} />
    </section>
  );
}

// components/LogPage/NotesSection.tsx
export function NotesSection() { ... }

// components/LogPage/StatsSection.tsx
export function StatsSection() { ... }
```

**æ“ä½œ**:
- [ ] æå–è®¡æ—¶å™¨åŒºå—
- [ ] æå–ç¬”è®°åŒºå—
- [ ] æå–ç»Ÿè®¡åŒºå—
- [ ] `/log/page.tsx` ä»…è´Ÿè´£å¸ƒå±€å’Œè·¯ç”±

---

### ğŸ¯ Phase 5: æµ‹è¯•ä¸æ–‡æ¡£ (1å¤©)

#### Step 5.1: å•å…ƒæµ‹è¯•

```typescript
// __tests__/useTimerControl.test.ts
describe('useTimerControl', () => {
  it('should start timer and update state', async () => {
    const { result } = renderHook(() => useTimerControl({...}));
    await act(() => result.current.startTimer('task-1'));
    expect(result.current.tasks[0].isRunning).toBe(true);
  });
});
```

**æ“ä½œ**:
- [ ] æµ‹è¯•å…³é”® hooks
- [ ] æµ‹è¯• API å±‚
- [ ] æµ‹è¯•ç»„ä»¶äº¤äº’

---

#### Step 5.2: æ–‡æ¡£æ›´æ–°

**æ“ä½œ**:
- [ ] æ›´æ–°ç»„ä»¶æ–‡æ¡£
- [ ] æ›´æ–° API æ–‡æ¡£
- [ ] åˆ›å»ºæ¶æ„å›¾
- [ ] ç¼–å†™è¿ç§»æŒ‡å—

---

## é£é™©è¯„ä¼°ä¸å›æ»šç­–ç•¥

### âš ï¸ é£é™©çŸ©é˜µ

| é£é™© | æ¦‚ç‡ | å½±å“ | ç¼“è§£æªæ–½ |
|------|------|------|---------|
| åŠŸèƒ½å›å½’ | ä¸­ | é«˜ | æ¯ä¸ª Phase ç‹¬ç«‹æµ‹è¯• |
| æ€§èƒ½ä¸‹é™ | ä½ | ä¸­ | æ€§èƒ½åŸºå‡†æµ‹è¯• |
| API å…¼å®¹æ€§ | ä½ | é«˜ | ä¿æŒæ¥å£ä¸å˜ |
| çŠ¶æ€ä¸ä¸€è‡´ | ä¸­ | é«˜ | Context ç»Ÿä¸€ç®¡ç† |

### ğŸ”„ å›æ»šç­–ç•¥

æ¯ä¸ª Phase éƒ½æ˜¯ç‹¬ç«‹çš„ Git åˆ†æ”¯ï¼š

```bash
# Phase 1
git checkout -b refactor/phase-1-types-api
# å®Œæˆååˆå¹¶
git checkout main
git merge refactor/phase-1-types-api

# å¦‚æœæœ‰é—®é¢˜
git revert <commit-hash>
```

### âœ… æ£€æŸ¥ç‚¹

æ¯ä¸ª Phase å®Œæˆåå¿…é¡»é€šè¿‡ï¼š

1. **åŠŸèƒ½æµ‹è¯•**: æ‰€æœ‰åŠŸèƒ½æ­£å¸¸è¿è¡Œ
2. **ç±»å‹æ£€æŸ¥**: `npm run type-check` æ— é”™è¯¯
3. **Lint æ£€æŸ¥**: `npm run lint` æ— é”™è¯¯
4. **æ„å»ºæµ‹è¯•**: `npm run build` æˆåŠŸ
5. **æ‰‹åŠ¨æµ‹è¯•**: åœ¨æµè§ˆå™¨ä¸­éªŒè¯æ ¸å¿ƒæµç¨‹

---

## æˆåŠŸæ ‡å‡†

### ğŸ“Š é‡åŒ–æŒ‡æ ‡

| æŒ‡æ ‡ | å½“å‰ | ç›®æ ‡ | éªŒè¯æ–¹å¼ |
|------|------|------|---------|
| **æœ€å¤§æ–‡ä»¶è¡Œæ•°** | 1,035 | < 300 | `wc -l` |
| **å¹³å‡æ–‡ä»¶è¡Œæ•°** | 500 | < 200 | ç»Ÿè®¡ |
| **Props æ•°é‡** | 19 | < 8 | ä»£ç å®¡æŸ¥ |
| **ç»„ä»¶åµŒå¥—æ·±åº¦** | 5 | < 3 | ä»£ç å®¡æŸ¥ |
| **åœˆå¤æ‚åº¦** | > 50 | < 10 | ESLint plugin |
| **ç±»å‹è¦†ç›–ç‡** | ~60% | > 95% | TypeScript strict mode |

### ğŸ¯ è´¨é‡ç›®æ ‡

- [ ] æ‰€æœ‰æ–‡ä»¶ < 300 è¡Œ
- [ ] æ‰€æœ‰ç»„ä»¶ Props < 8 ä¸ª
- [ ] æ—  `any` ç±»å‹
- [ ] 100% TypeScript strict mode
- [ ] æ‰€æœ‰ Hook æœ‰å•å…ƒæµ‹è¯•
- [ ] æ‰€æœ‰ç»„ä»¶æœ‰ Storybook æ–‡æ¡£

### ğŸš€ éåŠŸèƒ½æ€§ç›®æ ‡

- [ ] é¦–æ¬¡æ¸²æŸ“æ—¶é—´ < 200ms
- [ ] æ“ä½œå“åº”æ—¶é—´ < 100ms
- [ ] å†…å­˜å ç”¨æ— æ˜æ˜¾å¢åŠ 
- [ ] Bundle size æ— æ˜æ˜¾å¢åŠ 

---

## æ‰§è¡Œæ—¶é—´è¡¨

```
Week 1: Phase 1-2
â”œâ”€ Day 1-2: ç±»å‹å®šä¹‰ + API å±‚
â”œâ”€ Day 3-5: æ‹†åˆ† NestedTimerZone
â””â”€ Day 5: Review & æµ‹è¯•

Week 2: Phase 3-5
â”œâ”€ Day 1-2: Context çŠ¶æ€ç®¡ç†
â”œâ”€ Day 3: ä¼˜åŒ– /log/page
â”œâ”€ Day 4: æµ‹è¯•
â””â”€ Day 5: æ–‡æ¡£ + Review
```

**æ€»è®¡**: 10 ä¸ªå·¥ä½œæ—¥

---

## é™„å½•

### A. å‘½åçº¦å®š

```
# ç»„ä»¶
- PascalCase: TimerTask.tsx
- ä¸€ä¸ªæ–‡ä»¶ä¸€ä¸ªç»„ä»¶
- å¯¼å‡ºç»„ä»¶ä¸æ–‡ä»¶åç›¸åŒ

# Hooks
- camelCase: useTimerControl.ts
- ä»¥ 'use' å¼€å¤´
- è¿”å›å¯¹è±¡æˆ–æ•°ç»„

# ç±»å‹
- PascalCase: TimerTask
- æ¥å£ä»¥ I å¼€å¤´ï¼ˆå¯é€‰ï¼‰
- ç±»å‹åœ¨ types/ ç›®å½•

# å¸¸é‡
- UPPER_SNAKE_CASE: MAX_TASKS
- åœ¨å•ç‹¬çš„ constants.ts
```

### B. æ–‡ä»¶æ¨¡æ¿

```typescript
/**
 * @file TimerTask.tsx
 * @description å•ä¸ªè®¡æ—¶å™¨ä»»åŠ¡ç»„ä»¶
 * @author [Your Name]
 * @created 2025-10-29
 */

import type { TimerTask as Task } from '../../types';

interface TimerTaskProps {
  task: Task;
  // ...
}

/**
 * è®¡æ—¶å™¨ä»»åŠ¡ç»„ä»¶
 * 
 * @example
 * ```tsx
 * <TimerTask task={task} onStart={handleStart} />
 * ```
 */
export function TimerTask({ task }: TimerTaskProps) {
  // å®ç°
}
```

### C. å‚è€ƒèµ„æ–™

- [React ç»„ä»¶è®¾è®¡æ¨¡å¼](https://reactpatterns.com/)
- [TypeScript æœ€ä½³å®è·µ](https://typescript-handbook.org/)
- [è½¯ä»¶æ¶æ„æ•´æ´ä¹‹é“](https://clean-architecture.dev/)

---

## ç‰ˆæœ¬å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | å˜æ›´å†…å®¹ |
|------|------|---------|
| v1.0 | 2025-10-29 | åˆå§‹ç‰ˆæœ¬ |

---

**æ³¨æ„**: æ­¤è®¡åˆ’æ˜¯æ´»æ–‡æ¡£ï¼Œä¼šæ ¹æ®å®é™…æƒ…å†µè°ƒæ•´ã€‚æ¯ä¸ª Phase å®Œæˆåéœ€æ›´æ–°æœ¬æ–‡æ¡£ã€‚




