# 🎮 小黑盒爬虫配置步骤

## ✅ 测试进度
- ✅ Python环境检查（Python 3.12.10）
- ✅ 依赖安装（playwright, playwright-stealth, asyncpg, python-dotenv, requests）
- ✅ Playwright浏览器安装（Chromium）
- ✅ 爬虫脚本可执行
- ⚠️ 需要配置环境变量

---

## 📝 配置清单

### 1️⃣ 必填配置（在项目根目录 `.env` 文件中添加）

```env
# =============================================================================
# 小黑盒爬虫配置
# =============================================================================
# 小黑盒Token ID（必填）
# 你提供的token：BmG6lgAmG/emKgY6F+XyquvLgj0l21Tf6MDDBZSCR0v9o8u5H5M463Gz+ERKSJN1rb1nQpDeQWKmMcV2jIdcNIg%3D%3D
HEYBOX_TOKEN_ID=BmG6lgAmG/emKgY6F+XyquvLgj0l21Tf6MDDBZSCR0v9o8u5H5M463Gz+ERKSJN1rb1nQpDeQWKmMcV2jIdcNIg%3D%3D

# 爬取帖子数量（可选，默认20）
HEYBOX_POST_LIMIT=20

# 评论数量限制（可选，默认50）
HEYBOX_COMMENT_LIMIT=50
```

### 2️⃣ 检查现有配置是否正确

确保你的 `.env` 文件中已有以下配置：
- `DEEPSEEK_API_KEY=sk-xxx` （DeepSeek AI密钥）
- `DATABASE_URL=postgresql://xxx` （数据库连接串）

---

## 🚀 配置后的测试步骤

### 方法1：使用批处理脚本（推荐）

```bash
# 在项目根目录运行
.\run-heybox-scraper.bat
```

### 方法2：手动运行

```bash
# 1. 进入爬虫目录
cd linuxdo-scraper\heybox_scraper

# 2. 运行爬虫
python heybox_playwright_scraper.py
```

---

## 📊 预期输出

配置正确后，你应该看到类似输出：

```
2025-10-25 13:07:15 [INFO] 🎮 小黑盒Playwright爬虫启动
2025-10-25 13:07:15 [INFO] ✅ 配置检查通过
2025-10-25 13:07:15 [INFO] 🌐 启动Playwright浏览器...
2025-10-25 13:07:16 [INFO] 🔐 注入Token认证...
2025-10-25 13:07:17 [INFO] 📱 访问小黑盒首页...
2025-10-25 13:07:20 [INFO] 📊 提取帖子数据...
2025-10-25 13:07:21 [INFO] ✅ 找到 20 个帖子
2025-10-25 13:07:22 [INFO] 💾 保存到数据库...
2025-10-25 13:07:25 [INFO] ✨ 爬取完成！
```

---

## ❓ 常见问题

### Q1: 提示"未配置 HEYBOX_TOKEN_ID"
**A**: 检查 `.env` 文件是否在项目根目录，并且配置行无误（无多余空格）

### Q2: 提示"数据库连接失败"
**A**: 确保 `DATABASE_URL` 配置正确，且数据库可访问

### Q3: 提示"DeepSeek API错误"
**A**: 检查 `DEEPSEEK_API_KEY` 是否有效，或暂时跳过AI分析功能

### Q4: Python找不到模块
**A**: 重新安装依赖：
```bash
python -m pip install -r linuxdo-scraper\requirements.txt
```

---

## 📌 下一步

配置完成后：
1. ✅ 运行爬虫测试
2. ✅ 运行数据库迁移：`npx prisma migrate dev`
3. ✅ 启动前端：`npm run dev`
4. ✅ 访问 http://localhost:3000 查看效果

---

## 🔧 调试模式

如果遇到问题，可以启用详细日志：

```python
# 在 heybox_playwright_scraper.py 开头添加
import logging
logging.basicConfig(level=logging.DEBUG)
```


